<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J.A.R.V.I.S.</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/style.css?v=2">
</head>
<body>
    <!-- Sidebar overlay (mobile) -->
    <div id="sidebar-overlay" class="sidebar-overlay hidden"></div>

    <!-- Session sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>Sessions</h2>
            <button id="sidebar-close" class="sidebar-close" title="Close sidebar">&times;</button>
        </div>
        <div id="session-list" class="session-list"></div>
        <button id="btn-view-more" class="view-more-btn hidden">View more sessions</button>
    </aside>

    <!-- Header -->
    <header id="header">
        <div class="header-left">
            <div class="header-title-row">
                <button id="btn-hamburger" class="hamburger-btn" title="Toggle sessions sidebar">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
                <h1>J.A.R.V.I.S.</h1>
                <span id="connection-status" class="status disconnected">Disconnected</span>
            </div>
        </div>
        <div class="header-stats" id="header-stats">
            <div class="hud-stat">
                <span class="hud-label">LLM</span>
                <span class="hud-value" id="stat-llm">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">SKILLS</span>
                <span class="hud-value" id="stat-skills">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">MEMORY</span>
                <span class="hud-value" id="stat-memory">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">CONTEXT</span>
                <span class="hud-value" id="stat-context">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">WEB</span>
                <span class="hud-value" id="stat-web">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">NEWS</span>
                <span class="hud-value" id="stat-news">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">REMINDERS</span>
                <span class="hud-value" id="stat-reminders">--</span>
            </div>
            <div class="hud-stat">
                <span class="hud-label">CALENDAR</span>
                <span class="hud-value" id="stat-calendar">--</span>
            </div>
        </div>
    </header>

    <!-- Announcement banners (floating, auto-dismiss) -->
    <div id="announcement-container"></div>

    <!-- Chat area -->
    <main id="chat-area">
        <div id="messages"></div>
    </main>

    <!-- Document buffer indicator -->
    <div id="doc-indicator" class="hidden">
        <span id="doc-info"></span>
        <button id="doc-clear-btn" title="Clear document buffer">&times;</button>
    </div>

    <!-- Input area — 3-column layout -->
    <div id="input-area">
        <div class="input-columns">
            <!-- Left: Toolbar icons -->
            <div class="input-col-left">
                <div class="toolbar-group">
                    <button id="btn-paste" class="toolbar-btn" title="Paste text into document buffer">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                        </svg>
                    </button>
                    <button id="btn-append" class="toolbar-btn" title="Append text to document buffer">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="12" y1="8" x2="12" y2="16"/>
                            <line x1="8" y1="12" x2="16" y2="12"/>
                        </svg>
                    </button>
                    <button id="btn-file" class="toolbar-btn" title="Load file into document buffer">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
                        </svg>
                    </button>
                    <button id="btn-clipboard" class="toolbar-btn" title="Load clipboard into document buffer">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                            <line x1="9" y1="12" x2="15" y2="12"/>
                            <line x1="9" y1="16" x2="15" y2="16"/>
                        </svg>
                    </button>
                </div>
                <div class="toolbar-sep"></div>
                <div class="toolbar-group">
                    <button id="btn-context" class="toolbar-btn" title="Show document buffer info">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="8" y1="13" x2="16" y2="13"/>
                            <line x1="8" y1="17" x2="16" y2="17"/>
                        </svg>
                    </button>
                    <button id="btn-clear" class="toolbar-btn" title="Clear document buffer">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                    </button>
                    <button id="btn-help" class="toolbar-btn" title="Show help">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Center: Prompt -->
            <div class="input-col-center">
                <div class="input-row">
                    <textarea id="user-input" placeholder="Ask J.A.R.V.I.S. anything..." rows="1" autofocus></textarea>
                    <button id="btn-send" class="send-btn" title="Send message">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"/>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Right: Voice toggle + stacked buttons -->
            <div class="input-col-right">
                <label class="voice-toggle" title="Toggle voice output">
                    <input type="checkbox" id="voice-toggle">
                    <span class="toggle-slider"></span>
                    <span class="voice-label">Voice</span>
                </label>
                <div class="right-btn-stack">
                    <a href="/dashboard" class="restart-btn" title="Metrics Dashboard">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                        </svg>
                        <span class="restart-label">Metrics</span>
                    </a>
                    <button id="btn-restart" class="restart-btn" title="Restart server">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="23 4 23 10 17 10"/>
                            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                        </svg>
                        <span class="restart-label">Restart</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Paste modal -->
    <div id="paste-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Paste Text</h2>
                <button class="modal-close" id="paste-modal-close">&times;</button>
            </div>
            <textarea id="paste-textarea" placeholder="Paste or type text here..." rows="12"></textarea>
            <div class="modal-footer">
                <button id="paste-cancel" class="btn btn-secondary">Cancel</button>
                <button id="paste-submit" class="btn btn-primary">Load into Buffer</button>
            </div>
        </div>
    </div>

    <!-- Help modal -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>J.A.R.V.I.S. Web UI</h2>
                <button class="modal-close" id="help-modal-close">&times;</button>
            </div>
            <div class="help-body">
                <h3>Commands</h3>
                <p>Type naturally — J.A.R.V.I.S. routes to the right skill automatically.</p>
                <table>
                    <tr><td><strong>Time/Date</strong></td><td>"what time is it?"</td></tr>
                    <tr><td><strong>Weather</strong></td><td>"what's the weather?"</td></tr>
                    <tr><td><strong>System</strong></td><td>"what CPU do I have?"</td></tr>
                    <tr><td><strong>Files</strong></td><td>"write a script that..."</td></tr>
                    <tr><td><strong>Reminders</strong></td><td>"remind me to..."</td></tr>
                    <tr><td><strong>News</strong></td><td>"read the headlines"</td></tr>
                    <tr><td><strong>Web</strong></td><td>"search for..."</td></tr>
                    <tr><td><strong>Desktop</strong></td><td>"open brave", "volume up"</td></tr>
                    <tr><td><strong>General</strong></td><td>Any question — falls back to LLM</td></tr>
                </table>
                <h3>Toolbar</h3>
                <table>
                    <tr><td><strong>Paste</strong></td><td>Load text into document buffer for LLM context</td></tr>
                    <tr><td><strong>Clear</strong></td><td>Clear the document buffer</td></tr>
                    <tr><td><strong>Voice</strong></td><td>Toggle spoken responses on/off</td></tr>
                </table>
                <h3>Shortcuts</h3>
                <table>
                    <tr><td><kbd>Enter</kbd></td><td>Send message</td></tr>
                    <tr><td><kbd>Shift+Enter</kbd></td><td>New line</td></tr>
                    <tr><td><kbd>Ctrl+L</kbd></td><td>Clear chat display</td></tr>
                    <tr><td><kbd>&uarr;</kbd> / <kbd>&darr;</kbd></td><td>Command history</td></tr>
                    <tr><td><kbd>Esc</kbd></td><td>Close modals / sidebar</td></tr>
                </table>
                <h3>Sessions</h3>
                <p>Click the hamburger menu to browse past conversations. Double-click a session name to rename it.</p>
            </div>
            <div class="modal-footer">
                <button id="help-close" class="btn btn-primary">Got it</button>
            </div>
        </div>
    </div>

    <!-- File path modal with browser -->
    <div id="file-modal" class="modal hidden">
        <div class="modal-content modal-file-browser">
            <div class="modal-header">
                <h2>Load File</h2>
                <button class="modal-close" id="file-modal-close">&times;</button>
            </div>
            <div class="file-modal-body">
                <div class="file-path-row">
                    <label for="file-path-input">File path:</label>
                    <div class="file-path-input-row">
                        <input type="text" id="file-path-input" placeholder="/home/user/..." autocomplete="off">
                        <button id="btn-browse-toggle" class="btn btn-secondary btn-sm" title="Browse files">Browse</button>
                    </div>
                </div>
                <div id="file-browser" class="file-browser hidden">
                    <div class="file-browser-path" id="browser-current-path"></div>
                    <div class="file-browser-list" id="browser-list"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="file-cancel" class="btn btn-secondary">Cancel</button>
                <button id="file-submit" class="btn btn-primary">Load</button>
            </div>
        </div>
    </div>

    <!-- Append modal -->
    <div id="append-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Append Text</h2>
                <button class="modal-close" id="append-modal-close">&times;</button>
            </div>
            <textarea id="append-textarea" placeholder="Paste or type text to append..." rows="12"></textarea>
            <div class="modal-footer">
                <button id="append-cancel" class="btn btn-secondary">Cancel</button>
                <button id="append-submit" class="btn btn-primary">Append to Buffer</button>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
